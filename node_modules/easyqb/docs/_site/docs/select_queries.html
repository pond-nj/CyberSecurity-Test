<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Select - EasyQB</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Select | EasyQB</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Select" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Query builder for use with easybase-react &amp; easybasejs, based on Sqorn." /> <meta property="og:description" content="Query builder for use with easybase-react &amp; easybasejs, based on Sqorn." /> <link rel="canonical" href="http://localhost:4000/docs/select_queries.html" /> <meta property="og:url" content="http://localhost:4000/docs/select_queries.html" /> <meta property="og:site_name" content="EasyQB" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Select" /> <script type="application/ld+json"> {"headline":"Select","url":"http://localhost:4000/docs/select_queries.html","description":"Query builder for use with easybase-react &amp; easybasejs, based on Sqorn.","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/banner-logo.png"}},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="http://localhost:4000/docs/select_queries.html" class="nav-list-link active">Select</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/insert_queries.html" class="nav-list-link">Insert</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/delete_queries.html" class="nav-list-link">Delete</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/update_queries.html" class="nav-list-link">Update</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/executing_queries.html" class="nav-list-link">Executing Queries</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/expressions.html" class="nav-list-link">Expressions</a></li><li class="nav-list-item"><a href="http://localhost:4000/docs/operations.html" class="nav-list-link">Operations</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EasyQB" aria-label="Search EasyQB" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//easybase.io/react/" class="site-button" > Easybase with React </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <ul> <li><strong>With</strong> <a href="#with"><code class="language-plaintext highlighter-rouge">.with</code></a> <a href="#recursive-ctes"><code class="language-plaintext highlighter-rouge">.withRecursive</code></a></li> <li><strong>Select</strong> <a href="#select"><code class="language-plaintext highlighter-rouge">.return</code></a></li> <li><strong>Distinct</strong> <a href="#distinct"><code class="language-plaintext highlighter-rouge">.distinct</code></a> <a href="#distinct-on"><code class="language-plaintext highlighter-rouge">.distinctOn</code></a></li> <li><strong>From</strong> <a href="#from"><code class="language-plaintext highlighter-rouge">.from</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.join</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.leftJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.rightJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.fullJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.crossJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.naturalJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.naturalLeftJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.naturalRightJoin</code></a> <a href="#joins"><code class="language-plaintext highlighter-rouge">.naturalFullJoin</code></a> <a href="#on"><code class="language-plaintext highlighter-rouge">.on</code></a> <a href="#using"><code class="language-plaintext highlighter-rouge">.using</code></a></li> <li><strong>Where</strong> <a href="#where"><code class="language-plaintext highlighter-rouge">.where</code></a></li> <li><strong>Group By</strong> <a href="#group-by"><code class="language-plaintext highlighter-rouge">.groupBy</code></a> <a href="#rollup"><code class="language-plaintext highlighter-rouge">.rollup</code></a> <a href="#cube"><code class="language-plaintext highlighter-rouge">.cube</code></a> <a href="#grouping-sets"><code class="language-plaintext highlighter-rouge">.groupingSets</code></a></li> <li><strong>Having</strong> <a href="#having"><code class="language-plaintext highlighter-rouge">.having</code></a></li> <li><strong>Sets</strong> <a href="#union-intersect-except"><code class="language-plaintext highlighter-rouge">.union</code></a> <a href="#union-intersect-except"><code class="language-plaintext highlighter-rouge">.intersect</code></a> <a href="#union-intersect-except"><code class="language-plaintext highlighter-rouge">.except</code></a> <a href="#union-all-intersect-all-except-all"><code class="language-plaintext highlighter-rouge">.unionAll</code></a> <a href="#union-all-intersect-all-except-all"><code class="language-plaintext highlighter-rouge">.intersectAll</code></a> <a href="#union-all-intersect-all-except-all"><code class="language-plaintext highlighter-rouge">.exceptAll</code></a></li> <li><strong>Order By</strong> <a href="#order-by"><code class="language-plaintext highlighter-rouge">.orderBy</code></a></li> <li><strong>Limit</strong> <a href="#limit"><code class="language-plaintext highlighter-rouge">.limit</code></a></li> <li><strong>Offset</strong> <a href="#offset"><code class="language-plaintext highlighter-rouge">.offset</code></a></li> </ul> <h2 id="initialize"> <a href="#initialize" class="anchor-heading" aria-labelledby="initialize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initialize </h2> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">Easybase</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">easybasejs</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ebconfig</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./ebconfig.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nx">Easybase</span><span class="p">.</span><span class="nx">EasybaseProvider</span><span class="p">({</span> <span class="nx">ebconfig</span> <span class="p">}).</span><span class="nx">db</span><span class="p">(</span><span class="dl">"</span><span class="s2">MYTABLE</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">e</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">table</span><span class="p">;</span> <span class="c1">// Optional query expressions</span>
</code></pre></div></div> <h2 id="example-table"> <a href="#example-table" class="anchor-heading" aria-labelledby="example-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example Table </h2> <p>For the following queries, consider the data table below:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Avatar"</span><span class="p">,</span><span class="w"> </span><span class="nl">"rating"</span><span class="p">:</span><span class="w"> </span><span class="mi">83</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Titanic"</span><span class="p">,</span><span class="w"> </span><span class="nl">"rating"</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The Lion King"</span><span class="p">,</span><span class="w"> </span><span class="nl">"rating"</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jurassic World"</span><span class="p">,</span><span class="w"> </span><span class="nl">"rating"</span><span class="p">:</span><span class="w"> </span><span class="mi">59</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div> <h2 id="select"> <a href="#select" class="anchor-heading" aria-labelledby="select"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Select </h2> <p><code class="language-plaintext highlighter-rouge">.return</code> builds queries to select from. After building a query of any kind, use <code class="language-plaintext highlighter-rouge">.all</code> or <code class="language-plaintext highlighter-rouge">.one</code> to execute it.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">all</span><span class="p">();</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">},</span>
<span class="p">]</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.one</code> will only return the first match.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">one</span><span class="p">();</span>

<span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">}</span>
</code></pre></div></div> <p>Pass arguments into <code class="language-plaintext highlighter-rouge">.return</code> to select only specific columns.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">).</span><span class="nx">one</span><span class="p">();</span>

<span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span> <span class="p">}</span>
</code></pre></div></div> <h2 id="where"> <a href="#where" class="anchor-heading" aria-labelledby="where"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Where </h2> <p><code class="language-plaintext highlighter-rouge">.where</code> builds <em>where</em> clauses. Expressions, <code class="language-plaintext highlighter-rouge">e</code>, are are used to create comparisons and boolean logic. <a href="docs/expressions.html">Learn more about expressions</a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">)).</span><span class="nx">one</span><span class="p">()</span>

<span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">}</span>
</code></pre></div></div> <p>Conditions can be objects in the form <code class="language-plaintext highlighter-rouge">{ field: value }</code>.</p> <p>Each property generates a <code class="language-plaintext highlighter-rouge">field = value</code> clause.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">where</span><span class="p">({</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="na">rating</span><span class="p">:</span> <span class="mi">55</span> <span class="p">}).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <p>Use <a href="expressions">Expressions</a> to build complex conditions with <a href="operations#and"><code class="language-plaintext highlighter-rouge">e.and</code></a>, <a href="operations#or"><code class="language-plaintext highlighter-rouge">e.or</code></a> and <a href="operations#not"><code class="language-plaintext highlighter-rouge">e.not</code></a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">or</span><span class="p">(</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">),</span> <span class="c1">// Equals</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span> <span class="c1">// Greater than</span>
  <span class="p">)</span>
<span class="p">).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">array</code> arguments generate a <code class="language-plaintext highlighter-rouge">field in values</code> expression.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">where</span><span class="p">({</span> <span class="na">rating</span><span class="p">:</span> <span class="p">[</span><span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">]</span> <span class="p">}).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <h2 id="order-by"> <a href="#order-by" class="anchor-heading" aria-labelledby="order-by"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Order By </h2> <p>Specify row ordering with <code class="language-plaintext highlighter-rouge">.orderBy</code>. This function accepts objects.</p> <p>Property <code class="language-plaintext highlighter-rouge">by</code> is used for ordering. It can be a string, <a href="expressions">Expression</a>, <a href="manual-queries#fragments">Fragment</a> or <a href="manual-queries#subqueries">Subqueries</a>. Set property <code class="language-plaintext highlighter-rouge">sort</code> to either <code class="language-plaintext highlighter-rouge">'asc'</code> or <code class="language-plaintext highlighter-rouge">'desc'</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">().</span><span class="k">return</span><span class="p">().</span><span class="nx">orderBy</span><span class="p">({</span> <span class="na">by</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">,</span> <span class="na">sort</span><span class="p">:</span> <span class="dl">"</span><span class="s2">asc</span><span class="dl">"</span> <span class="p">}).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.orderBy</code> accepts multiple sort objects, which will be evaluated in order.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">().</span><span class="k">return</span><span class="p">().</span><span class="nx">orderBy</span><span class="p">({</span> <span class="na">by</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">,</span> <span class="na">sort</span><span class="p">:</span> <span class="dl">"</span><span class="s2">asc</span><span class="dl">"</span> <span class="p">},</span> <span class="p">{</span> <span class="na">by</span><span class="p">:</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="na">sort</span><span class="p">:</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span> <span class="p">}).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <h2 id="limit"> <a href="#limit" class="anchor-heading" aria-labelledby="limit"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Limit </h2> <p>Pass <code class="language-plaintext highlighter-rouge">.limit</code> the maximum number of rows to fetch.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <h2 id="offset"> <a href="#offset" class="anchor-heading" aria-labelledby="offset"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Offset </h2> <p>Pass <code class="language-plaintext highlighter-rouge">.offset</code> the number of rows to skip before returning rows.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">offset</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.offset</code> and <code class="language-plaintext highlighter-rouge">.limit</code> can be used in conjugation for pagination of your data table.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">offset</span><span class="p">(</span><span class="nx">page</span> <span class="o">*</span> <span class="mi">2</span><span class="p">).</span><span class="nx">all</span><span class="p">();</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Avatar</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">83</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Titanic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">75</span> <span class="p">}</span>
<span class="p">]</span>

<span class="nx">page</span><span class="o">++</span><span class="p">;</span>
<span class="k">await</span> <span class="nx">table</span><span class="p">.</span><span class="k">return</span><span class="p">().</span><span class="nx">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">offset</span><span class="p">(</span><span class="nx">page</span> <span class="o">*</span> <span class="mi">2</span><span class="p">).</span><span class="nx">all</span><span class="p">();</span>

<span class="p">[</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The Lion King</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">55</span> <span class="p">},</span>
  <span class="p">{</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Jurassic World</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">rating</span><span class="dl">"</span><span class="p">:</span> <span class="mi">59</span> <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div> <h2 id="joins"> <a href="#joins" class="anchor-heading" aria-labelledby="joins"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Joins </h2> <p><code class="language-plaintext highlighter-rouge">.join</code>, <code class="language-plaintext highlighter-rouge">.leftJoin</code>, <code class="language-plaintext highlighter-rouge">.rightJoin</code> and <code class="language-plaintext highlighter-rouge">.fullJoin</code> build inner, left, right and full joins respectively. Either <a href="#on"><code class="language-plaintext highlighter-rouge">.on</code></a> or <a href="#using"><code class="language-plaintext highlighter-rouge">.using</code></a> must be called immediately after.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="s2">`book`</span><span class="p">.</span><span class="nx">join</span><span class="s2">`author`</span><span class="p">.</span><span class="nx">on</span><span class="s2">`book.author_id = author.id`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from book join author on (book.author_id = author.id)</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.naturalJoin</code>, <code class="language-plaintext highlighter-rouge">.naturalLeftJoin</code>, <code class="language-plaintext highlighter-rouge">.naturalRightJoin</code> and <code class="language-plaintext highlighter-rouge">.naturalFullJoin</code> build natural joins. Calling <a href="#on"><code class="language-plaintext highlighter-rouge">.on</code></a> or <a href="#using"><code class="language-plaintext highlighter-rouge">.using</code></a> after a natural join is invalid.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="s2">`book`</span><span class="p">.</span><span class="nx">naturalRightJoin</span><span class="s2">`author`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from book natural right join author</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.crossJoin</code> builds a cross join.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="s2">`book`</span><span class="p">.</span><span class="nx">crossJoin</span><span class="s2">`author`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from book cross join author</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p>Join methods accept the same arguments as <a href="#from"><code class="language-plaintext highlighter-rouge">.from</code></a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">b</span><span class="p">:</span> <span class="dl">'</span><span class="s1">book</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">naturalFullJoin</span><span class="p">({</span> <span class="na">a</span><span class="p">:</span> <span class="dl">'</span><span class="s1">author</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">naturalRightJoin</span><span class="p">(</span><span class="dl">'</span><span class="s1">publisher</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select book b natural full join author a natural right join publisher</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>

</code></pre></div></div> <h3 id="on"> <a href="#on" class="anchor-heading" aria-labelledby="on"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> On </h3> <p><code class="language-plaintext highlighter-rouge">.on</code> specifies join conditions. It accepts the same arguments as <a href="#where"><code class="language-plaintext highlighter-rouge">.where</code></a>. <code class="language-plaintext highlighter-rouge">.on</code> must be called exactly once.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">b</span><span class="p">:</span> <span class="dl">'</span><span class="s1">book</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">({</span> <span class="na">a</span><span class="p">:</span> <span class="dl">'</span><span class="s1">author</span><span class="dl">'</span><span class="p">}).</span><span class="nx">on</span><span class="p">({</span> <span class="dl">'</span><span class="s1">b.author_id</span><span class="dl">'</span><span class="p">:</span> <span class="nx">sq</span><span class="p">.</span><span class="nx">raw</span><span class="p">(</span><span class="dl">'</span><span class="s1">a.id</span><span class="dl">'</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from book b join author a on (b.author_id = a.id)</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p>Build complex join conditions with <a href="expressions">Expressions</a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="p">({</span> <span class="na">t</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ticket</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">leftJoin</span><span class="p">({</span> <span class="na">p</span><span class="p">:</span> <span class="dl">'</span><span class="s1">person</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">or</span><span class="p">(</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">eq</span><span class="s2">`p.first_name``t.first_name`</span><span class="p">,</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">eq</span><span class="s2">`p.last_name``t.last_name`</span>
  <span class="p">))</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from ticket t left join person p on ((p.first_name = t.first_name) or (p.last_name = t.last_name))</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <h3 id="using"> <a href="#using" class="anchor-heading" aria-labelledby="using"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using </h3> <p>Alternatively, specify join columns with <code class="language-plaintext highlighter-rouge">.using</code>. <code class="language-plaintext highlighter-rouge">.using</code> must be called exactly once.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="s2">`book`</span><span class="p">.</span><span class="nx">join</span><span class="s2">`author`</span><span class="p">.</span><span class="nx">using</span><span class="s2">`author_id`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from book join author using (author_id)</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.using</code> accepts strings.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">b</span><span class="dl">'</span><span class="p">).</span><span class="nx">using</span><span class="p">(</span><span class="dl">'</span><span class="s1">x</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">y</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">z</span><span class="dl">'</span><span class="p">).</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from a join b using (x, y, z)</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <h2 id="sets"> <a href="#sets" class="anchor-heading" aria-labelledby="sets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sets </h2> <h3 id="union-intersect-except"> <a href="#union-intersect-except" class="anchor-heading" aria-labelledby="union-intersect-except"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Union, Intersect, Except </h3> <p>Pass select subqueries to <code class="language-plaintext highlighter-rouge">.union</code>, <code class="language-plaintext highlighter-rouge">.intersect</code> and <code class="language-plaintext highlighter-rouge">.except</code> to perform set operations.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Person</span> <span class="o">=</span> <span class="nx">sq</span><span class="p">.</span><span class="k">from</span><span class="s2">`person`</span>
<span class="kd">const</span> <span class="nx">Young</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">where</span><span class="s2">`age &lt; 30`</span>
<span class="kd">const</span> <span class="nx">Middle</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">where</span><span class="s2">`age &gt;= 30 and age &lt; 60`</span>
<span class="kd">const</span> <span class="nx">Old</span> <span class="o">=</span> <span class="nx">Person</span><span class="p">.</span><span class="nx">where</span><span class="s2">`age &gt;= 60`</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">except</span><span class="p">(</span><span class="nx">Young</span><span class="p">).</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from person except (select * from person where (age &lt; 30))</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>

<span class="nx">Young</span><span class="p">.</span><span class="nx">union</span><span class="p">(</span><span class="nx">Middle</span><span class="p">,</span> <span class="nx">Old</span><span class="p">).</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from person where (age &lt; 30) union (select * from person where (age &gt;= 30 and age &lt; 60)) union (select * from person where (age &gt;= 60))</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <h3 id="union-all-intersect-all-except-all"> <a href="#union-all-intersect-all-except-all" class="anchor-heading" aria-labelledby="union-all-intersect-all-except-all"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Union All, Intersect All, Except All </h3> <p><code class="language-plaintext highlighter-rouge">.unionAll</code>, <code class="language-plaintext highlighter-rouge">.intersectAll</code> and <code class="language-plaintext highlighter-rouge">.exceptAll</code> can be used to prevent duplicate elimination.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Young</span><span class="p">.</span><span class="nx">unionAll</span><span class="p">(</span><span class="nx">Old</span><span class="p">).</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from person where (age &lt; 30) union all (select * from person where (age &gt;= 60))</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <p>Set operators can be chained.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Person</span><span class="p">.</span><span class="nx">except</span><span class="p">(</span><span class="nx">Young</span><span class="p">).</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">Person</span><span class="p">.</span><span class="nx">except</span><span class="p">(</span><span class="nx">Old</span><span class="p">)).</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select * from person except (select * from person where (age &lt; 30)) intersect (select * from person except (select * from person where (age &gt;= 60)))</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <h2 id="with"> <a href="#with" class="anchor-heading" aria-labelledby="with"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With </h2> <p>Construct CTEs (Common Table Expressions) with <code class="language-plaintext highlighter-rouge">.with</code>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="kd">with</span><span class="s2">`n (select </span><span class="p">${</span><span class="mi">20</span><span class="p">}</span><span class="s2"> age)`</span><span class="p">.</span><span class="k">from</span><span class="s2">`n`</span><span class="p">.</span><span class="k">return</span><span class="s2">`age`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">with n (select $1 age) select age from n</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.with</code> can be called multiple times.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="kd">with</span><span class="s2">`width (select </span><span class="p">${</span><span class="mi">10</span><span class="p">}</span><span class="s2"> n)`</span>
  <span class="p">.</span><span class="kd">with</span><span class="s2">`height (select </span><span class="p">${</span><span class="mi">20</span><span class="p">}</span><span class="s2"> n)`</span>
  <span class="p">.</span><span class="k">return</span><span class="s2">`width.n * height.n area`</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">with width (select $1 n), height (select $2 n) select width.n * height.n area</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">.with</code> accepts objects in the form <code class="language-plaintext highlighter-rouge">{ alias: table }</code>. Tables can be <a href="manual-queries#subqueries">Subqueries</a>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sq</span><span class="p">.</span><span class="kd">with</span><span class="p">({</span>
    <span class="na">width</span><span class="p">:</span> <span class="nx">sq</span><span class="p">.</span><span class="k">return</span><span class="p">({</span> <span class="na">n</span><span class="p">:</span> <span class="mi">10</span> <span class="p">}),</span>
    <span class="na">height</span><span class="p">:</span> <span class="nx">sq</span><span class="p">.</span><span class="nx">sql</span><span class="s2">`select </span><span class="p">${</span><span class="mi">20</span><span class="p">}</span><span class="s2"> n`</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">return</span><span class="p">({</span> <span class="na">area</span><span class="p">:</span> <span class="nx">sq</span><span class="p">.</span><span class="nx">txt</span><span class="s2">`width.n * height.n`</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">with width (select $1 n), height (select $2 n) select width.n * height.n area</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div> <p>Tables can be arrays of row objects. A <em>values</em> clause is generated. Column names are inferred from all keys.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">people</span> <span class="o">=</span> <span class="p">[{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Jo</span><span class="dl">'</span> <span class="p">},</span> <span class="p">{</span> <span class="na">age</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Mo</span><span class="dl">'</span> <span class="p">}]</span>
<span class="nx">sq</span><span class="p">.</span><span class="kd">with</span><span class="p">({</span> <span class="nx">people</span> <span class="p">}).</span><span class="k">return</span><span class="s2">`max(age)`</span><span class="p">.</span><span class="k">from</span><span class="s2">`people`</span><span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">with people(age, name) (values ($1, $2), ($3, $4)) select max(age) from people</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Jo</span><span class="dl">'</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Mo</span><span class="dl">'</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div></div> <h3 id="recursive-ctes"> <a href="#recursive-ctes" class="anchor-heading" aria-labelledby="recursive-ctes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recursive CTEs </h3> <p><code class="language-plaintext highlighter-rouge">.withRecursive</code> creates a <em>recursive</em> CTE.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">one</span> <span class="o">=</span> <span class="nx">sq</span><span class="p">.</span><span class="k">return</span><span class="s2">`1`</span>
<span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">sq</span><span class="p">.</span><span class="k">return</span><span class="s2">`n + 1`</span><span class="p">.</span><span class="k">from</span><span class="s2">`t`</span><span class="p">.</span><span class="nx">where</span><span class="s2">`n &lt; 100`</span>
<span class="nx">sq</span><span class="p">.</span><span class="nx">withRecursive</span><span class="p">({</span> <span class="dl">'</span><span class="s1">t(n)</span><span class="dl">'</span><span class="p">:</span> <span class="nx">one</span><span class="p">.</span><span class="nx">unionAll</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">})</span>
  <span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">t</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="k">return</span><span class="p">(</span><span class="dl">'</span><span class="s1">sum(n)</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">query</span>

<span class="p">{</span> <span class="nl">text</span><span class="p">:</span> <span class="dl">'</span><span class="s1">with recursive t(n) (select 1 union all (select n + 1 from t where (n &lt; 100))) select sum(n) from t</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">args</span><span class="p">:</span> <span class="p">[]</span> <span class="p">}</span>
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2018-2021 Easybase</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
